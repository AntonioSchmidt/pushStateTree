!function(a){"use strict";function b(a){return!isNaN(parseFloat(a))&&a%1===0&&isFinite(a)}function c(a,b,c){Object.defineProperty(a,b,{get:function(){return c},set:function(){}})}function d(a){return/^[a-z0-9]+:\/\//i.test(a)}function e(a){return"#"===a[0]&&(a=a.slice(1)),"/"!==a[0]}function f(b){if(b=b||{},x){for(var d in b)b.hasOwnProperty(d)&&(w[d]=b[d]);return w}x=!0,f.prototype.hasPushState?(Object.defineProperty(w,n,{get:function(){return f.prototype[n]},set:function(a){f.prototype[n]=a!==!1}}),f.prototype[n]=b[n]!==!1):c(w,n,!1),w.basePath=b.basePath||w.basePath||"";for(var d in f.prototype)f.prototype.hasOwnProperty(d)&&!function(a){if("function"==typeof f.prototype[a])w[a]=function(){return f.prototype[a].apply(this,arguments)};else{if("undefined"!=typeof w[a])return;Object.defineProperty(w,a,{get:function(){return f.prototype[a]},set:function(b){f.prototype[a]=b}})}}(d);c(w,"length",a.history.length),c(w,"state",a.history.state),Object.defineProperty(w,"uri",{get:function(){var a,b=j.href.indexOf("#");return-1!==b?(a=j.href.slice(b+1),a=a.replace(/^[#]+/,"")):(a=j.href.slice(j.origin.length),0===a.indexOf(this.basePath)&&(a=a.slice(this.basePath.length))),a=a.replace(/^[\/]+/,"")},configurable:!0}),w.eventStack={leave:[],change:[],enter:[],match:[]},a.addEventListener(p,function(){w.rulesDispatcher(),z=w.uri,y=w.state}.bind(w)),a.addEventListener(o,F);var e=function(){a.dispatchEvent(new l(o))};return h.addEventListener("DOMContentLoaded",e),a.addEventListener("readystatechange",e),a.addEventListener("load",function(){e(),k&&a.setInterval(function(){return w.uri!==z?void e():void(E&&(E=!1,z=w.uri,a.addEventListener(o,F)))}.bind(w),50)}.bind(w)),new f(b)}function g(){a.removeEventListener(o,F),E=!0}var h=a.document,i=a.window,j=a.location,k=function(){var a=i.navigator.userAgent.indexOf("Trident");return a>=0}();!function(){a.location.origin||(a.location.origin=a.location.protocol+"//"+a.location.host)}(),function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){var e=a;return this instanceof d&&a&&(e=this),c.apply(e,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e})}();var l=a.HashChangeEvent,m=a.Event;!function(){function b(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=h.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}if(Element.prototype.addEventListener){b.prototype=m.prototype,(!a.CustomEvent||k)&&(a.CustomEvent=b),(!l||a.opera&&a.opera.version()<15||k)&&(l=a.CustomEvent),k&&(m=b);try{new l("hashchange")}catch(c){l=b}try{new m("popstate")}catch(c){m=b}}}(),function(){if(!Element.prototype.addEventListener&&Object.defineProperty){var b=h.createEventObject().constructor.prototype;Object.defineProperty(b,"target",{get:function(){return this.srcElement}});var c=function(a,b){this.__bindedFunctions||(this.__bindedFunctions=[]);var c=b;if(!("on"+a in this)||"hashchange"===a){this.__elemetIEid=this.__elemetIEid||"__ie__"+Math.random();var d=a+this.__elemetIEid;h.documentElement[d];var e=this,f=function(a){a.propertyName===d&&c.call(e,h.documentElement[d])};if(this.__bindedFunctions.push({original:c,binded:f}),h.documentElement.attachEvent("onpropertychange",f),"hashchange"!==a)return}var g=c.bind(this);this.__bindedFunctions.push({original:c,binded:g}),this.attachEvent("on"+a,g)};HTMLDocument.prototype.addEventListener=c,Element.prototype.addEventListener=c,i.addEventListener=c;var d=function(a,b){this.__bindedFunctions||(this.__bindedFunctions=[]);var c,d=b;if(!("on"+a in this)||"hashchange"===a){for(var e=0;e<this.__bindedFunctions.length;e++)this.__bindedFunctions[e].original===d&&(c=this.__bindedFunctions[e].binded,this.__bindedFunctions=this.__bindedFunctions.splice(e,1),e=this.__bindedFunctions.length);if(c&&h.documentElement.detachEvent("onpropertychange",c),"hashchange"!==a)return}for(var e=0;e<this.__bindedFunctions.length;e++)this.__bindedFunctions[e].original===d&&(c=this.__bindedFunctions[e].binded,this.__bindedFunctions=this.__bindedFunctions.splice(e,1),e=this.__bindedFunctions.length);c&&this.detachEvent("on"+a,c)};HTMLDocument.prototype.removeEventListener=d,Element.prototype.removeEventListener=d,i.removeEventListener=d,m=function(b,c){var d=h.createEventObject();return c=c||{},d.type=b,d.detail=c.detail,"on"+b in a&&"hashchange"!==b||(d.name=b,d.customEvent=!0),d},CustomEvent=m,l=CustomEvent;var e=function(a){if(!a.customEvent)return void this.fireEvent(a.type,a);if(this.__elemetIEid){var b=a.name+this.__elemetIEid;h.documentElement[b]=a}};HTMLDocument.prototype.dispatchEvent=e,Element.prototype.dispatchEvent=e,i.dispatchEvent=e}}(),function(){var a="forEach"in Array.prototype;if(!a){var b=Array.prototype.slice;Array.prototype.slice=function(a,c){for(var d=[],e=0,f=this.length;f>e;e++)e in this&&d.push(this[e]);return b.apply(d,arguments)}}"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)c in this&&a.call(b,this[c],c)}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d})}();var n="usePushState",o="hashchange",p="popstate",q="leave",r="update",s="enter",t="change",u="match",v="oldMatch",w=h.createElement("pushstatetree-route"),x=!1,y=null,z=null,A=[],B=!1,C=!1;f.prototype={createRule:function(a){var c=h.createElement("pushstatetree-rule"),d={regexp:new RegExp,attribute:""};Object.defineProperty(c,"rule",{get:function(){var a=c.getAttribute("rule")||"";if(d.attribute!==a){d.attribute=a;var b="";if("/"===a[0]){var e=a.lastIndexOf("/");e>0&&(b=a.slice(e+1),a=a.slice(1,e))}d.regexp=new RegExp(a,b)}return d.regexp},set:c.setAttribute.bind(c,"rule")}),Object.defineProperty(c,"parentGroup",{get:function(){var a=c.getAttribute("parent-group");return a&&b(a)?+a:null},set:function(a){b(a)?c.setAttribute("parent-group",a):c.removeAttribute("parent-group")}});for(var e in a)a.hasOwnProperty(e)&&(c[e]=a[e]);var f=[];Object.defineProperty(c,u,{get:function(){return f},set:function(a){f=a instanceof Array?a:[]}});var g=[];return Object.defineProperty(c,v,{get:function(){return g},set:function(a){g=a instanceof Array?a:[]}}),c[u]=[],c[v]=[],c.navigate=c.assign=function(){this.parentElement.assign.apply(this.parentElement,arguments)},c.replace=function(){this.parentElement.replace.apply(this.parentElement,arguments)},c.dispatch=function(){this.parentElement.dispatch.apply(this.parentElement,arguments)},c.pushState=function(){this.parentElement.pushState.apply(this.parentElement,arguments)},c.replaceState=function(){this.parentElement.replaceState.apply(this.parentElement,arguments)},c},add:function(a){this.appendChild(this.createRule(a))},remove:function(a){var b=a;return"string"==typeof a&&(b=this.querySelector(a)),b&&b.parentElement?(b.parentElement.removeChild(b),b):void 0},dispatch:function(){return C?(B=!0,this):(B=!1,a.dispatchEvent(new m(p)),this)},assign:function(a){return this.pushState(null,null,a).dispatch()},replace:function(a){return this.replaceState(null,null,a).dispatch()},navigate:function(){this.assign.apply(this,arguments)},rulesDispatcher:function(){function b(a,b){return Array.prototype.slice.call(this.children||this.childNodes).forEach(c.bind(this,a,b)),a}function c(b,e,f){function g(b,c){c=c||{},c.detail=c.detail||{},c.detail[u]=k||[],c.detail[v]=l||[],c.cancelable=!0,d&&console;var e=new a.CustomEvent(b,c);return e}if(f.rule){var h,i=b,j=e;"number"==typeof f.parentGroup&&(i="",h=f.parentElement,h[u].length>f.parentGroup&&(i=h[u][f.parentGroup]||""),j="",h[v].length>f.parentGroup&&(j=h[v][f.parentGroup]||"")),f[u]=i[u](f.rule),"string"==typeof j?f[v]=j[u](f.rule):f[v]=[];var k=f[u],l=f[v],m=Array.prototype.slice.call(f.children);if(0===k.length){if(0===l.length||f.routerURI!==e)return;return f.uri=null,f.removeAttribute("uri"),m.forEach(c.bind(this,b,e)),void this.eventStack[q].push({element:f,events:[new g(r,{detail:{type:q}}),new g(q)]})}this.eventStack[u].push({element:f,events:[new g(u)]});var n=f.routerURI!==e;if(f.routerURI=this.uri,f.uri=k[0],f.setAttribute("uri",k[0]),0===l.length||n)return this.eventStack[s].push({element:f,events:[new g(r,{detail:{type:s}}),new g(s)]}),void m.forEach(c.bind(this,b,e));k[0]!==l[0]&&this.eventStack[t].push({element:f,events:[new g(r,{detail:{type:t}}),new g(t)]}),m.forEach(c.bind(this,b,e))}}var d=this.debug;if(A.push(b.bind(this,this.uri)),!(A.length>1)){for(var e=z;A.length>0;)e=A[0].call(null,e),A.shift();C=!0;for(var f=this.eventStack;f.leave.length>0;){for(var g=f.leave[0].events,h=f.leave[0].element;g.length>0;)h.dispatchEvent(g[0]),g.shift();f.leave.shift()}for(;f.change.length>0;){for(var g=f.change[0].events,h=f.change[0].element;g.length>0;)h.dispatchEvent(g[0]),g.shift();f.change.shift()}for(;f.enter.length>0;){for(var g=f.enter[0].events,h=f.enter[0].element;g.length>0;)h.dispatchEvent(g[0]),g.shift();f.enter.shift()}for(;f.match.length>0;){for(var g=f.match[0].events,h=f.match[0].element;g.length>0;)h.dispatchEvent(g[0]),g.shift();f.match.shift()}C=!1,B&&this.dispatch()}}};for(var D in a.history)"function"==typeof a.history[D]&&function(){var b=D;this[D]=function(){var c=Array.prototype.slice.call(arguments);return("pushState"===b||"replaceState"===b)&&(this[n]||d(c[2])||"#"===c[2][0]?d(c[2])||this.basePath&&!e(c[2])&&"#"!==c[2][0]&&(c[2]=this.basePath+c[2]):(e(c[2])&&(c[2]=a.location.hash.slice(1,a.location.hash.lastIndexOf("/")+1)+c[2]),c[2]="#"+c[2])),a.history[b].apply(a.history,c),this}}.bind(f.prototype)();var E=!1,F=function(){E||z!==w.uri&&(w.rulesDispatcher(),z=w.uri,y=w.state)}.bind(w);f.prototype.hasPushState=a.history&&!!a.history.pushState,f.prototype.hasPushState||(f.prototype[n]=!1);var G=null;f.prototype.pushState||(f.prototype.pushState=function(b,c,f){var i=h.title||"";return null!==G&&(h.title=G),g(),d(f)&&(a.location.href=f),"#"===f[0]&&(f=f.slice(1)),e(f)&&(f=a.location.hash.slice(1,a.location.hash.lastIndexOf("/")+1)+f),a.location.hash=f,h.title=i,G=c,this}),f.prototype.replaceState||(f.prototype.replaceState=function(b,c,f){var i=h.title||"";if(null!==G&&(h.title=G),g(),d(f))throw new Error("Invalid url replace.");if("#"===f[0]&&(f=f.slice(1)),e(f)){var j=a.location.hash.lastIndexOf("/")+1;f=a.location.hash.slice(1,j)+f}return f="#"+f,a.location.replace(f),h.title=i,G=c,this}),a.PushStateTree=f,"undefined"!=typeof module&&(module.exports=f)}(function(){return this}());
//# sourceMappingURL=pushStateTree.map