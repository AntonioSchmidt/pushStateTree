//! push-state-tree - v0.12.0 - 2015-06-07
//* https://github.com/gartz/pushStateTree/
//* Copyright (c) 2015 Gabriel Reitz Giannattasio <gabriel@gartz.com.br>; Licensed 

var PushStateTree = {options: {VERSION: '0.12.0'}};
var PushStateTree={options:{VERSION:"0.12.0"}};!function(a){"use strict";function b(a){return!isNaN(parseFloat(a))&&a%1===0&&isFinite(a)}function c(a,b,c){Object.defineProperty(a,b,{get:function(){return c},set:function(){}})}function d(a){return/^[a-z0-9]+:\/\//i.test(a)}function e(a){return/^[^#/]/.test(a)}function f(b){function d(a){if("function"==typeof f.prototype[a])A[a]=function(){return f.prototype[a].apply(this,arguments)};else{if("undefined"!=typeof A[a])return;Object.defineProperty(A,a,{get:function(){return f.prototype[a]},set:function(b){f.prototype[a]=b}})}}if(b=b||{},this.VERSION=z,B){for(var e in b)b.hasOwnProperty(e)&&(A[e]=b[e]);return A}B=!0,f.prototype.hasPushState?(Object.defineProperty(A,o,{get:function(){return f.prototype[o]},set:function(a){f.prototype[o]=a!==!1}}),f.prototype[o]=b[o]!==!1):c(A,o,!1),Object.defineProperty(A,"beautifyLocation",{get:function(){return!!f.prototype.beautifyLocation},set:function(a){f.prototype.beautifyLocation=!!a}});var g;Object.defineProperty(A,"basePath",{get:function(){return g},set:function(a){a=a||"",g=a.match(/^(\/)?((.*?)\/?)(\/*)$/)[3]+"/"}});for(var h in f.prototype)f.prototype.hasOwnProperty(h)&&d(h);c(A,"length",a.history.length),c(A,"state",a.history.state);var j={url:"",uri:""};Object.defineProperty(A,"uri",{get:function(){if(j.url===a.location.href)return j.uri;var b;return a.location.hash.length||"#"===a.location.href[k.href.length-1]?(b=a.location.hash.match(/^(#*)?(.*\/?)/)[2],A.beautifyLocation&&A.usePushState&&A.replaceState(A.state,A.title,"/"===b[0]?b:"/"+b)):(b=a.location.pathname+a.location.search,0===b.indexOf("/"+this.basePath)&&(b=b.slice(this.basePath.length))),b=b.replace(/^[\/]+/,""),A.getAttribute("uri")!==b&&A.setAttribute("uri",b),j.url=a.location.href,j.uri=b,b},configurable:!0}),A.eventStack={leave:[],change:[],enter:[],match:[]},a.addEventListener(q,function(){var a=A.uri,b=A.state;A.rulesDispatcher(),D=a,C=b,F&&this.dispatch()}.bind(A)),a.addEventListener(p,J);var n=function(){a.dispatchEvent(new m(p))};return i.addEventListener("DOMContentLoaded",n),a.addEventListener("readystatechange",n),a.addEventListener("load",function(){n(),l&&a.setInterval(function(){return A.uri!==D?void n():void(I&&(I=!1,D=A.uri,a.addEventListener(p,J)))}.bind(A),50)}.bind(A)),new f(b)}function g(b){var c=b;this[b]=function(){var b=Array.prototype.slice.call(arguments);if(("pushState"===c||"replaceState"===c)&&!d(b[2])){if(e(b[2])){var f=this.uri.match(/^(.*)\//);f=f?f[1]+"/":"",b[2]=f+b[2]}else b[2]=b[2].match(/^([#/]*)?(.*)/)[2];this[o]?b[2]=this.basePath+b[2]:b[2]="#"+b[2]}return a.history[c].apply(a.history,b),this}}function h(){a.removeEventListener(p,J),I=!0}var i=a.document,j=a.window,k=a.location,l=function(){var a=j.navigator.userAgent.indexOf("Trident");return a>=0}();!function(){a.location.origin||(a.location.origin=a.location.protocol+"//"+a.location.host)}(),function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){var e=a;return this instanceof d&&a&&(e=this),c.apply(e,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e})}();var m=a.HashChangeEvent,n=a.Event;!function(){function b(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=i.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}if(Element.prototype.addEventListener){b.prototype=n.prototype,(!a.CustomEvent||l)&&(a.CustomEvent=b),(!m||a.opera&&a.opera.version()<15||l)&&(m=a.CustomEvent),l&&(n=b);try{new m("hashchange")}catch(c){m=b}try{new n("popstate")}catch(c){n=b}}}(),function(){if(!Element.prototype.addEventListener&&Object.defineProperty){var b=i.createEventObject().constructor.prototype;Object.defineProperty(b,"target",{get:function(){return this.srcElement}});var c=function(a,b){this.__bindedFunctions||(this.__bindedFunctions=[]);var c=b;if(!("on"+a in this)||"hashchange"===a){this.__elemetIEid=this.__elemetIEid||"__ie__"+Math.random();var d=a+this.__elemetIEid,e=this,f=function(a){a.propertyName===d&&c.call(e,i.documentElement[d])};if(this.__bindedFunctions.push({original:c,binded:f}),i.documentElement.attachEvent("onpropertychange",f),"hashchange"!==a)return}var g=c.bind(this);this.__bindedFunctions.push({original:c,binded:g}),this.attachEvent("on"+a,g)};HTMLDocument.prototype.addEventListener=c,Element.prototype.addEventListener=c,j.addEventListener=c;var d=function(a,b){this.__bindedFunctions||(this.__bindedFunctions=[]);var c,d=b;if(!("on"+a in this)||"hashchange"===a){for(var e=0;e<this.__bindedFunctions.length;e++)this.__bindedFunctions[e].original===d&&(c=this.__bindedFunctions[e].binded,this.__bindedFunctions=this.__bindedFunctions.splice(e,1),e=this.__bindedFunctions.length);if(c&&i.documentElement.detachEvent("onpropertychange",c),"hashchange"!==a)return}for(var f=0;f<this.__bindedFunctions.length;f++)this.__bindedFunctions[f].original===d&&(c=this.__bindedFunctions[f].binded,this.__bindedFunctions=this.__bindedFunctions.splice(f,1),f=this.__bindedFunctions.length);c&&this.detachEvent("on"+a,c)};HTMLDocument.prototype.removeEventListener=d,Element.prototype.removeEventListener=d,j.removeEventListener=d,n=function(b,c){var d=i.createEventObject();return c=c||{},d.type=b,d.detail=c.detail,"on"+b in a&&"hashchange"!==b||(d.name=b,d.customEvent=!0),d},CustomEvent=n,m=CustomEvent;var e=function(a){if(!a.customEvent)return void this.fireEvent(a.type,a);if(this.__elemetIEid){var b=a.name+this.__elemetIEid;i.documentElement[b]=a}};HTMLDocument.prototype.dispatchEvent=e,Element.prototype.dispatchEvent=e,j.dispatchEvent=e}}(),function(){var a="forEach"in Array.prototype;if(!a){var b=Array.prototype.slice;Array.prototype.slice=function(){for(var a=[],c=0,d=this.length;d>c;c++)c in this&&a.push(this[c]);return b.apply(a,arguments)}}"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0;c<this.length;c++)c in this&&a.call(b,this[c],c)}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d})}();var o="usePushState",p="hashchange",q="popstate",r="leave",s="update",t="enter",u="change",v="match",w="oldMatch",x=a.PushStateTree&&a.PushStateTree.options||{},y=a.DEBUG||x.DEBUG,z=x.VERSION||"development",A=i.createElement("pushstatetree-route"),B=!1,C=null,D=null,E=[],F=!1,G=!1;f.prototype={beautifyLocation:!0,createRule:function(a){var c=i.createElement("pushstatetree-rule"),d=new RegExp("");Object.defineProperty(c,"rule",{get:function(){return d},set:function(a){if(a instanceof RegExp)d=a;else{if(a===d.toString())return;var b=(a+"").match(/^\/(.+)\/([gmi]*)|(.*)/);d=new RegExp(b[1]||b[3],b[2])}c.setAttribute("rule",d.toString())}}),Object.defineProperty(c,"parentGroup",{get:function(){var a=c.getAttribute("parent-group");return a&&b(a)?+a:null},set:function(a){b(a)?c.setAttribute("parent-group",a):c.removeAttribute("parent-group")}});for(var e in a)a.hasOwnProperty(e)&&(c[e]=a[e]);var f=[];Object.defineProperty(c,v,{get:function(){return f},set:function(a){f=a instanceof Array?a:[]}});var g=[];return Object.defineProperty(c,w,{get:function(){return g},set:function(a){g=a instanceof Array?a:[]}}),c[v]=[],c[w]=[],["assign","navigate","replace","dispatch","pushState","replaceState"].forEach(function(a){c[a]=function(){this.parentElement[a].apply(this.parentElement,arguments)}}),c},add:function(a){return this.appendChild(this.createRule(a)),this},remove:function(a){var b=a;return"string"==typeof a&&(b=this.querySelector(a)),b&&b.parentElement?(b.parentElement.removeChild(b),b):void 0},dispatch:function(){return G?(F=!0,this):(F=!1,a.dispatchEvent(new n(q)),this)},assign:function(a){return this.pushState(null,null,a).dispatch()},replace:function(a){return this.replaceState(null,null,a).dispatch()},navigate:function(){this.assign.apply(this,arguments)},rulesDispatcher:function(){function b(a,b){return Array.prototype.slice.call(this.children||this.childNodes).forEach(c.bind(this,a,b)),a}function c(b,e,f){function g(b,c){c=c||{},c.detail=c.detail||{},c.detail[v]=k||[],c.detail[w]=l||[],c.cancelable=!0,d&&console&&(console.log({name:b,ruleElement:f,params:c,useURI:i,useOldURI:j}),console.trace&&console.trace());var e=new a.CustomEvent(b,c);return e}if(f.rule){var h,i=b,j=e;"number"==typeof f.parentGroup&&(i="",h=f.parentElement,h[v].length>f.parentGroup&&(i=h[v][f.parentGroup]||""),j="",h[w].length>f.parentGroup&&(j=h[w][f.parentGroup]||"")),f[v]=i[v](f.rule),"string"==typeof j?f[w]=j[v](f.rule):f[w]=[];var k=f[v],l=f[w],m=Array.prototype.slice.call(f.children);if(0===k.length){if(0===l.length||f.routerURI!==e)return;return f.uri=null,f.removeAttribute("uri"),m.forEach(c.bind(this,b,e)),f.dispatchEvent(new g(s,{detail:{type:r}})),void f.dispatchEvent(new g(r))}this.eventStack[v].push({element:f,events:[new g(v)]});var n=f.routerURI!==e;if(f.routerURI=this.uri,f.uri=k[0],f.setAttribute("uri",k[0]),0===l.length||n)return this.eventStack[t].push({element:f,events:[new g(s,{detail:{type:t}}),new g(t)]}),void m.forEach(c.bind(this,b,e));k[0]!==l[0]&&this.eventStack[u].push({element:f,events:[new g(s,{detail:{type:u}}),new g(u)]}),m.forEach(c.bind(this,b,e))}}var d=this.debug===!0||y;if(E.push(b.bind(this,this.uri)),!(E.length>1)){for(var e=D;E.length>0;)e=E[0].call(null,e),E.shift();G=!0;var f=this.eventStack;[u,t,v].forEach(function(a){for(;f[a].length>0;){for(var b=f[a][0].events,c=f[a][0].element;b.length>0;)c.dispatchEvent(b[0]),b.shift();f[a].shift()}}),G=!1}}};for(var H in a.history)"function"==typeof a.history[H]&&g.call(f.prototype,H);var I=!1,J=function(){if(!I&&D!==A.uri){var a=A.uri,b=A.state;A.rulesDispatcher(),D=a,C=b,F&&this.dispatch()}}.bind(A);f.prototype.hasPushState=a.history&&!!a.history.pushState,f.prototype.hasPushState||(f.prototype[o]=!1);var K=null;f.prototype.pushState||(f.prototype.pushState=function(b,c,f){var g=i.title||"";return f=f||"",null!==K&&(i.title=K),h(),d(f)&&(a.location.href=f),"#"===f[0]&&(f=f.slice(1)),e(f)&&(f=a.location.hash.slice(1,a.location.hash.lastIndexOf("/")+1)+f),a.location.hash=f,i.title=g,K=c,this}),f.prototype.replaceState||(f.prototype.replaceState=function(b,c,f){var g=i.title||"";if(f=f||"",null!==K&&(i.title=K),h(),d(f))throw new Error("Invalid url replace.");if("#"===f[0]&&(f=f.slice(1)),e(f)){var j=a.location.hash.lastIndexOf("/")+1;f=a.location.hash.slice(1,j)+f}return f="#"+f,a.location.replace(f),i.title=g,K=c,this}),a.PushStateTree=f,"undefined"!=typeof module&&(module.exports=f)}(function(){return this}());